#!/bin/bash
#
#
# author stefano fattore
#
# version BETA 0.3

if [ $# == 1 ]; then
    if [ $1 == "--help" ] || [ $1 == "-h" ]; then
        echo "installer [options]"
        echo
        echo "  --configure"
        echo "      initializes the configuration process"
        echo
        echo "[WARN] => Must be run as sudo or with root privileges"
        exit 0
    fi
fi

echo "==============================================="
echo "             Autogit installer"
echo "==============================================="
echo

if [[ $(/usr/bin/id -u) -ne 0 ]]; then
    echo "[ERR] => Not running as root, use user root account or sudo"
    exit -1
fi

echo "Copying the executable into /usr/local/bin.."
if ! sudo cp autogit /usr/local/bin; then
    echo "An error occurred while copying executable, exiting"
    exit -1
fi

echo "Generating entry for man.."

if [[ ! -d "/usr/local/man/man1" ]]
then
    sudo mkdir /usr/local/man/man1
fi

{
    if ! sudo rm -f /usr/local/man/man1/autogit.1.gz; then
        echo "An error occurred while generating entry for man, exiting"
        exit -1
    fi
    if ! sudo cp autogit.1 /usr/local/man/man1; then
        echo "An error occurred while generating entry for man, exiting"
        exit -1
    fi
    if ! sudo gzip /usr/local/man/man1/autogit.1; then
        echo "An error occurred while generating entry for man, exiting"
        exit -1
    fi
} &> /dev/null


echo "Running trigger for man-db.."

{
    if ! sudo mandb; then
        echo "An error occurred while running trigger for man-db, exiting"
        exit -1
    fi
} &> /dev/null


echo "done"

if [ $# == 1 ]; then
    echo
    if [ $1 == "--configure" ]; then
        exec ./autogitconfigure --initall
    fi
fi